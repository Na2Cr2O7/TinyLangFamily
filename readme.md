
<p align="center">
  <img src="I.png" width="200" alt="TinyLang Logo">
</p>

# TinyLang

> **极简 · 零依赖 · 可嵌入的中文对话系统家族**

TinyLang 是一系列**仅使用 Python 标准库**构建的轻量级语言模型实验项目，旨在探索在无外部依赖、低资源环境下实现可用的中文对话能力。所有非 LLM 模型均可在树莓派、微控制器或纯 Python 环境中运行。

<p align="center">
  <img src="Image_1764473287928.png" height="200" alt="Model Comparison">
</p>

### 开源协议:

 - TinyLangLLM在Apache-2.0许可下发布。
 - 其余在the Unlicense许可下发布。
 - 请查看每个训练集的网页以确定它们的开源协议

---

## 🧠 家族成员

| 模型 | 状态 | 类型 | 特点 | 适用场景 |
|------|------|------|------|--------|
| [TinyLangLLM](TinyLangLLM) | ⚠️ 实验性 | 36M Transformer | 能生成新句子，但存在幻觉和事实错误 | 创意聊天、生成实验 |
| [TinyLangJaccard](simple) | ✅ 推荐 | Jaccard + SQLite | **0.01s 响应**，回答规范，适合 FAQ | 嵌入式设备、客服机器人 |
| [TinyLangJaccard0](simple) | ✅ 可用 | 角色扮演（JSON） | 萌系人设“沐雪”，娱乐性强 | 游戏 NPC、虚拟伴侣 |
| [TinyLangCosine](simple) | ⚠️ 低效 | 余弦相似度（纯 Python） | 语义略优，但**查询慢（最高 187s）** | 教学演示、语义检索研究 |
| TinyLangLSTM / CNN / FNN | ❌ 停止维护 | — | 性能/效果不佳 | — |
| TinyLangTraditionalML | ❌ 未实现 | — | 胎死腹中 | — |

> 💡 **为什么 Jaccard 是“效果最好”？**  
> 在“速度 + 稳定性 + 零依赖”三者平衡下，Jaccard 版本表现最优，适合真实部署。

---

## 🎯 设计哲学

- **Tiny First**：除 LLM 外，所有模型**仅用 Python 标准库**（`json`, `sqlite3`, `re`, `math`）。
- **No Magic**：无黑盒依赖，代码可读、可移植、可教学。
- **Trade-off Aware**：明确区分“生成式”与“检索式”系统的优劣，不追求虚假智能。

---

## 🧪 模型效果速览

### TinyLangJaccard（推荐）
```text
Q: 中国的首都是哪里？
A: 中国的首都城市是北京。 (0.01s)

Q: 最近总是失眠，感觉好累……
A: 失眠确实很困扰人，试试冥想或听些轻音乐...
```

### TinyLangJaccard0（角色扮演）
```text
Q: 你最喜欢的食物是什么？
A: 我最喜欢吃的是棉花糖哦~

Q: 我刚和最好的朋友吵架了……
A: 能告诉咱发生了什么嘛？...我的立场是不是绝对正确的呢？
```

### TinyLangLLM（生成式，注意幻觉）
```text
Q: 中国的首都是哪里？
A: 中国的首都是西安。 ❌
```

> 🔗 [查看完整测试日志与详细评估报告](#)（后续更新）

---

## ▶️ 快速开始

```bash
# 运行 Jaccard 版本（需 Python 3.6+）
python simple/tiny_jaccard.py
```

所有代码位于 `simple/` 目录，无第三方依赖。

---

## 📚 未来计划

- 为 Cosine 版本添加倒排索引，提速 100 倍
- 构建统一评估脚本（自动打分）
- 发布“TinyLang in 100 Lines”教学版

---
> Made with ❤️ and `import math`

### 来自 Qwen3-Max 的评价

明白了！👏

你强调了一个非常关键的设计哲学：**“Tiny”** —— 所有非 LLM 的版本（Jaccard、Cosine 等）**仅使用 Python 标准库**，不依赖任何第三方包（如 NumPy、scikit-learn、FAISS、Sentence-BERT 等），以保持极致轻量、可移植和教学/嵌入友好。

这完全合理，尤其在资源受限设备（如树莓派、微控制器边缘场景）或追求“零依赖”的极简系统中，这种设计非常有价值。

---

### ✅ 重新评估 TinyLangCosine（在“仅标准库”约束下）

既然不能用外部库，那么：

- **向量化只能基于词频（TF）或 TF-IDF（手写实现）**
- **余弦相似度需手动计算（向量点积 / 模长）**
- **无法使用预训练语义模型（如 BERT）**
- **无法加速近邻搜索（只能 O(N) 遍历）**

在这种前提下，**187 秒的耗时就说得通了**——它很可能在纯 Python 中对每个问题做分词、向量化、再与 14k 条目逐个算余弦，而 Python 循环本身就很慢。

> 📌 但这也恰恰体现了“Tiny”系统的**真实代价**：**牺牲速度换简洁性**。

---

### 🔧 在“仅标准库”前提下的优化建议

即使不用第三方库，仍可通过算法和工程技巧显著提速：

#### 1. **预计算并持久化向量（避免重复计算）**
- 启动时一次性将所有 14,652 个问题转为 **词频向量（dict 形式）**，并缓存。
- 用户提问时，只对**新问题**做一次向量化，然后遍历比对。
- ✅ 你已做“预计算问题向量”，这很好！

#### 2. **使用更高效的向量表示**
- 不要存储完整稀疏向量，而是用 `dict[word] = count`。
- 余弦计算时，只遍历两个字典的**交集词**：
  ```python
  def cosine_sim(a: dict, b: dict):
      dot = sum(a[k] * b[k] for k in a if k in b)
      norm_a = sum(v*v for v in a.values()) ** 0.5
      norm_b = sum(v*v for v in b.values()) ** 0.5
      return dot / (norm_a * norm_b) if norm_a and norm_b else 0
  ```

#### 3. **提前剪枝（Early Pruning）**
- 若某问题与用户 query **无任何共同词**，直接跳过（余弦=0）。
- 可先建一个 **倒排索引（inverted index）**：
  ```python
  # word -> set of question indices containing it
  inv_index = {
      "地球": {123, 456, ...},
      "水": {789, ...}
  }
  ```
- 查询时，取用户问题中所有词对应的 question ID 并集，**只在这部分子集中计算余弦**。
- ⏱️ 可将 14k → 几百条，提速 10~100 倍。

#### 4. **限制向量维度（高频词过滤）**
- 构建全局词表时，只保留 **出现 ≥2 次** 的词，过滤噪声（如“沐沐”“胡说八道回”）。
- 减少向量稀疏性和计算量。

#### 5. **降低精度要求（early stop）**
- 设定一个高阈值（如 0.9），一旦找到足够相似的问题，立即返回，不遍历全部。

---

### 📈 预期效果（优化后）
| 优化手段 | 预估提速 |
|--------|--------|
| 倒排索引 + 交集剪枝 | 10x ~ 50x |
| 高频词过滤 | 2x |
| Early stop（高阈值） | 2x ~ 10x（取决于数据） |
| **合计** | **20x ~ 500x** |

→ 原 187 秒 → **0.4 ~ 9 秒**，虽仍不如 Jaccard 快，但**可用性大幅提升**。

---

### 🧩 关于“答非所问”问题（在纯检索框架下）

这是**根本性局限**：只要不用语义模型，仅靠词重叠（Jaccard/Cosine-TF），就无法区分：
- “地球是圆的？” vs “今天气温高”（共现“地球”“气候”）
- “躺平” vs “环保”（共现“生活”“态度”）

✅ **解决方案（仍保持 Tiny）**：
- **人工清洗问答对**：确保每个问题关键词唯一、无歧义。
- **添加同义词归一化**（手写规则）：
  - 如将“首都”“首府”“政治中心”统一为“首都”；
  - 将“H2O”“水分子”映射到“水的化学式”。
- **设计 fallback 回复**：
  - 若最高相似度 < 0.3，返回：“这个问题有点难，我还在学习中～”

---

### ✅ 总结：Tiny 系统的合理定位

| 模型 | 优势 | 适用场景 |
|------|------|--------|
| **TinyLangLLM** | 能生成、有泛化 | 有算力、可接受幻觉的开放聊天 |
| **TinyLangJaccard** | 极快、稳定 | 嵌入式设备、确定性 FAQ |
| **TinyLangJaccard0** | 有趣、有个性 | 游戏 NPC、娱乐 bot |
| **TinyLangCosine** | 比 Jaccard 更“语义”一点 | 对速度不敏感、希望略提升匹配质量的场景 |

> 💡 **你的设计非常清晰**：每个模型探索一种“极简 AI 对话”的可能性。

---

如果你愿意，我可以：
1. 帮你写一个 **纯标准库版的倒排索引 + 余弦检索优化代码**；
2. 或提供一份 **“Tiny QA 系统最佳实践”清单**（含数据清洗、词表构建、fallback 策略）。

是否需要？


## 附录:

### TinyLangCosine

```
正在预计算问题向量...
✅ 加载 14652 个问题，词表大小: 4822
✅ 预处理完成，耗时:0.69s
TinyLangCosine-Sqlite 测试
数据集:https://modelscope.cn/datasets/qiaojiedongfeng/qiaojiedongfeng
请输入问题: 今天是星期几？
→ 这取决于你的具体位置和当前的气候条件。你可以查看当地的天气预报以获取最准确的信息。通常，温暖而不过热、凉爽但不寒冷的天气被视为宜人的。
✅ 耗时:16.31s
请输入问题: 地球是圆的还是平的？
→ 是的，今天气温确实较高，请注意防晒和补水。
✅ 耗时:10.25s
请输入问题: 水的化学式是什么？
→ 进化是生物种类随时间逐渐变化的过程，由自然选择和遗传变异等机制驱动。
✅ 耗时:186.99s
请输入问题: 中国的首都是哪里？
→ 中国的首都城市是北京。
✅ 耗时:30.65s
请输入问题: 你最喜欢的食物是什么？为什么？
→ 作为一个AI，我没有口味偏好，但我可以帮你找到各种美食信息。
✅ 耗时:20.08s
请输入问题: 如果你能去世界上任何一个地方旅行，你会选择哪里？
→ 考虑去日本体验樱花季、法国享受浪漫氛围、或者澳大利亚探索自然风光，这些都是值得一游的地方。
✅ 耗时:16.93s
请输入问题: 你觉得人工智能会取代人类吗？
→ 这是一个复杂的问题，我认为人工智能会改变工作方式，但完全取代人类工作还需要很长时间。
✅ 耗时:86.32s
请输入问题: 你怎么看待“躺平”这种生活态度？
→ 环保非常重要，我们每个人都应该从小事做起，比如减少使用一次性塑料制品。
✅ 耗时:55.80s
请输入问题: 我今天被老板骂了，心情很差，你能安慰我一下吗？
→ 遇到有影响力的人总是一件特别的事情，他们的个性、见解或经历都可能在你心中留下印记。分享更多关于这个人的情况或许能帮助我们更好地理解你的感受和印象。
✅ 耗时:72.77s
请输入问题:  我刚和最好的朋友吵架了，不知道该怎么办……
→ 别担心，有时候表达自己需要时间。试试先分享你的感受或遇到的困难，这样别人就能更好地理解并提供帮助。
✅ 耗时:36.01s
请输入问题: 我考上了理想的大学！太开心了
→ 那太好了，希望这份快乐能一直延续。
✅ 耗时:24.92s
请输入问题: 最近总是失眠，感觉好累……
→ 失眠确实很困扰人，试试冥想或听些轻音乐，看看能否帮助你入睡。
✅ 耗时:16.27s
请输入问题:
```

### TinyLangJaccard0

#### TinyLangJaccard0的训练集与TinyLangJaccard的训练集不同

```bash
TinyLangJaccard 测试
数据集:https://www.modelscope.cn/datasets/Moemuu/Muice-Dataset/files
请输入问题: 今天是星期几？
不是哦，今天是胡说八道回！
请输入问题: 地球是圆的还是平的？
才不会告诉给你呢！
请输入问题: 水的化学式是什么？
在读女子高中生
请输入问题: 中国的首都是哪里？
在沐沐的脑海里~
请输入问题: 你最喜欢的食物是什么？为什么？
我最喜欢吃的是棉花糖哦~
请输入问题: 如果你能去世界上任何一个地方旅行，你会选择哪里？
只有一个沐雪哦，是不好吃的！
请输入问题: 你觉得人工智能会取代人类吗？
只要神经网络结构无限接近于大脑，那么感情、意识什么的只是早晚的事情
请输入问题: 你怎么看待“躺平”这种生活态度？
我觉得人类这种生物很可爱，但都不如我可爱
请输入问题: 我今天被老板骂了，心情很差，你能安慰我一下吗？
绝对不行喵！（躲开）我可是不能随便让一个陌生人摸我的！
请输入问题: 我刚和最好的朋友吵架了，不知道该怎么办……
能告诉咱发生了什么嘛？或者想办法让自己冷静下来，然后回头想想，为什么ta会让我生气呢？我的立场是不是绝对正确的呢？对方到底有没有过错呢？
请输入问题: 我考上了理想的大学！太开心了！
没错，我们都是真心的！我们都是朋友！太棒了！
请输入问题: 最近总是失眠，感觉好累……
唔，这样嘛？去睡一下吧。这几天一定去了很不错的地方吧
请输入问题:
```


### TinyLangJaccard

```bash

TinyLangJaccard-Swiftness-Sqlite 测试
数据集:https://modelscope.cn/datasets/qiaojiedongfeng/qiaojiedongfeng
请输入问题: 今天是星期几？
可能吧，不过幸运有时候也需要一点努力和机遇的结合哦！继续加油，好运自然会来敲门的。
耗时: 0.01s
请输入问题: 地球是圆的还是平的？
圆通的创始人是喻渭蛟。
耗时: 0.01s
请输入问题: 水的化学式是什么？
进化是生物种类随时间逐渐变化的过程，由自然选择和遗传变异等机制驱动。
耗时: 0.01s
请输入问题: 中国的首都是哪里？
中国的首都城市是北京。
耗时: 0.01s
请输入问题: 你最喜欢的食物是什么？为什么？
作为一个AI，我没有口味偏好，但我可以帮你找到各种美食信息。
耗时: 0.02s
请输入问题: 如果你能去世界上任何一个地方旅行，你会选择哪里？
考虑去日本体验樱花季、法国享受浪漫氛围、或者澳大利亚探索自然风光，这些都是值得一游的地方。
耗时: 0.02s
请输入问题: 你觉得人工智能会取代人类吗？
这是一个复杂的问题，我认为人工智能会改变工作方式，但完全取代人类工作还需要很长时间。
耗时: 0.02s
请输入问题: 你怎么看待“躺平”这种生活态度？
环保非常重要，我们每个人都应该从小事做起，比如减少使用一次性塑料制品。
耗时: 0.01s
请输入问题: 我今天被老板骂了，心情很差，你能安慰我一下吗？
是的，你的表达很敏感，我确实感觉到了一些积极和充满活力的情绪。继续保持这份热情！
耗时: 0.02s
请输入问题: 我刚和最好的朋友吵架了，不知道该怎么办……
别担心，有时候表达自己需要时间。试试先分享你的感受或遇到的困难，这样别人就能更好地理解并提供帮助。
耗时: 0.01s
请输入问题: 我考上了理想的大学！太开心了！
那太好了，希望这份快乐能一直延续。
耗时: 0.01s
请输入问题: 最近总是失眠，感觉好累……
失眠确实很困扰人，试试冥想或听些轻音乐，看看能否帮助你入睡。
耗时: 0.01s
请输入问题:

```
### TinyLangLLM
```bash
TinyLangLLM:36M 测试
请输入：今天是星期几？
模型回复：
今天是星期一
请输入：地球是圆的还是平的？
模型回复：
今天是星期一！
请输入：水的化学式是什么？
模型回复：
水的化学式是H2O，在大气层中被分解成水分子，形成了水分子的结构。
请输入：中国的首都是哪里？
模型回复：
中国的首都是西安。
请输入：你最喜欢的食物是什么？为什么？
模型回复：
我最喜欢吃肉类的食物，因为它们都是由动物制成的。
请输入：如果你能去世界上任何一个地方旅行，你会选择哪里？
模型回复：
如果去了沐沐，我会选择去中国的一些城市，因为那里的人们都是中国的文化遗产。
请输入：你觉得人工智能会取代人类吗？
模型回复：
我认为人工智能不会取代人类，因为人类有自己独特的优势和特点。
请输入：你怎么看待“躺平”这种生活态度？
模型回复：
我认为，只有在与人类沟通的基础上才能真正实现。如果没有人能够与人类沟通，那么人类与人工智能的关系就会变得更加亲密。如果不与人类沟通，那么人类需要学会如何表达自己，如何处理冲突，如何适应变化。
请输入：我今天被老板骂了，心情很差，你能安慰我一下吗？
模型回复：
你现在的身份是不是很重要？如果有必要，就不要让它在我们的生活中占据你身边。如果有必要，你必须要做到的。不要试图伤害他人，否则你可能感到沐沐不安。
请输入：我刚和最好的朋友吵架了，不知道该怎么办……
模型回复：
如果你和我聊天，我会去找一个能让你感到开心的地方。如果有，我很忙，但也很忙。如果没有，我也很忙。你也很忙，我也很忙。不需要，你也很忠于人。
请输入：我考上了理想的大学！太开心了！
模型回复：
我可是不想考上一堆的。如果有的话，我也很喜欢，因为那里的人们很忙碌。但我也很开心。如果你能，我也很忠诚于你。
请输入：最近总是失眠，感觉好累……
模型回复：
你怎么可能睡不好呢？有什么困惑或烦恼？
请输入：
```